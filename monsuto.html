<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brawl Stars風ゲーム</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background-color: #f4f4f4;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: Arial, sans-serif;
        }
        canvas {
            background-color: #e6e6e6;
            border: 2px solid #333;
        }
        .score-board {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 20px;
            color: #000;
        }
        .hp-bar, .mana-bar {
            position: absolute;
            top: 40px;
            left: 10px;
            width: 200px;
            height: 10px;
            background-color: #ddd;
            border-radius: 5px;
        }
        .hp-fill, .mana-fill {
            height: 100%;
            border-radius: 5px;
        }
        .hp-fill { background-color: green; }
        .mana-fill { background-color: blue; }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div class="score-board">スコア: <span id="score">0</span></div>
    <div class="hp-bar" id="playerHpBar"><div class="hp-fill" id="playerHpFill"></div></div>
    <div class="hp-bar" id="enemyHpBar"><div class="hp-fill" id="enemyHpFill"></div></div>
    <div class="mana-bar" id="playerManaBar"><div class="mana-fill" id="playerManaFill"></div></div>
    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        // ゲームの設定
        const player = {
            x: 100,
            y: 300,
            width: 50,
            height: 50,
            color: 'blue',
            speed: 5,
            hp: 100,
            maxHp: 100,
            mana: 100,
            maxMana: 100,
            attackRange: 150,
            isAttacking: false,
            skillReady: true, // スキルが使えるか
            skillCooldown: 3000, // スキルのクールダウン（3秒）
            lastSkillUse: 0,
        };

        const enemy = {
            x: 600,
            y: 300,
            width: 50,
            height: 50,
            color: 'red',
            speed: 3,
            hp: 100,
            maxHp: 100,
            isAttacking: false
        };

        const obstacles = [
            { x: 300, y: 200, width: 100, height: 100 }, // 障害物
            { x: 500, y: 400, width: 150, height: 100 }
        ];

        const bullets = [];
        let score = 0;

        // プレイヤーの移動と攻撃制御
        document.addEventListener('keydown', (event) => {
            if (event.key === 'ArrowUp') player.y -= player.speed;
            if (event.key === 'ArrowDown') player.y += player.speed;
            if (event.key === 'ArrowLeft') player.x -= player.speed;
            if (event.key === 'ArrowRight') player.x += player.speed;
            if (event.key === ' ' && player.skillReady) useSkill();  // スペースキーでスキル発動
        });

        // プレイヤーのスキル（例: シールド or ダメージ増加）
        function useSkill() {
            player.skillReady = false;
            player.mana -= 30;  // スキル使用でマナ消費
            setTimeout(() => {
                player.skillReady = true; // クールダウン終了
            }, player.skillCooldown);

            // スキルが発動した場合（仮にダメージ増加やシールドを発動する）
            console.log("スキル発動!");
        }

        function shootBullet() {
            const bullet = {
                x: player.x + player.width / 2,
                y: player.y + player.height / 2,
                radius: 5,
                speed: 7,
                target: { x: enemy.x + enemy.width / 2, y: enemy.y + enemy.height / 2 }
            };
            bullets.push(bullet);
        }

        function updateBullets() {
            for (let i = 0; i < bullets.length; i++) {
                const bullet = bullets[i];
                const dx = bullet.target.x - bullet.x;
                const dy = bullet.target.y - bullet.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                const angle = Math.atan2(dy, dx);

                bullet.x += Math.cos(angle) * bullet.speed;
                bullet.y += Math.sin(angle) * bullet.speed;

                // 弾が敵に当たった場合
                if (isCollision(bullet, enemy)) {
                    enemy.hp -= 20;
                    bullets.splice(i, 1);
                    i--;
                    if (enemy.hp <= 0) {
                        score += 100;
                        resetGame();
                    }
                }
            }
        }

        function isCollision(bullet, target) {
            return !(bullet.x + bullet.radius < target.x || 
                     bullet.x - bullet.radius > target.x + target.width || 
                     bullet.y + bullet.radius < target.y || 
                     bullet.y - bullet.radius > target.y + target.height);
        }

        function updateEnemyAI() {
            const dx = player.x - enemy.x;
            const dy = player.y - enemy.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            const angle = Math.atan2(dy, dx);

            if (distance > 50) {
                enemy.x += Math.cos(angle) * enemy.speed;
                enemy.y += Math.sin(angle) * enemy.speed;
            } else if (distance < 50) {
                shootBullet(); // 敵も攻撃
            }
        }

        function drawMap() {
            // 障害物を描画
            ctx.fillStyle = "#8B4513"; // 障害物の色
            obstacles.forEach(obs => {
                ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
            });
        }

        function drawPlayer() {
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.width, player.height);
        }

        function drawEnemy() {
            ctx.fillStyle = enemy.color;
            ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
        }

        function drawHealthBars() {
            const playerHpPercentage = player.hp / player.maxHp;
            const enemyHpPercentage = enemy.hp / enemy.maxHp;

            document.getElementById('playerHpFill').style.width = `${playerHpPercentage * 200}px`;
            document.getElementById('enemyHpFill').style.width = `${enemyHpPercentage * 200}px`;
        }

        function drawManaBars() {
            const playerManaPercentage = player.mana / player.maxMana;
            document.getElementById('playerManaFill').style.width = `${playerManaPercentage * 200}px`;
        }

        function drawScore() {
            document.getElementById('score').textContent = score;
        }

        function resetGame() {
            player.hp = player.maxHp;
            enemy.hp = enemy.maxHp;
            player.mana = player.maxMana;
            player.x = 100;
            player.y = 300;
            enemy.x = 600;
            enemy.y = 300;
        }

        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            drawMap();
            updateBullets();
            updateEnemyAI();
            drawPlayer();
            drawEnemy();
            drawHealthBars();
            drawManaBars();
            drawScore();

            if (player.hp <= 0) {
                alert("ゲームオーバー！");
                resetGame();
            }

            requestAnimationFrame(gameLoop);
        }

        gameLoop();
    </script>
</body>
</html>
